# .render/render.yaml
# Render service definitions for Website Intelligence Platform
# Backend API + Background Worker

services:
  # -----------------------
  # Web Service (FastAPI)
  # -----------------------
  - type: web
    name: ai-intel-backend
    env: docker
    repo: https://github.com/Joeches/Website-Intelligence-Platform
    branch: main
    dockerfilePath: backend/Dockerfile
    plan: starter
    autoDeploy: true

    # Docker handles build; no additional build commands needed
    buildCommand: ""
    startCommand: "uvicorn main:app --host 0.0.0.0 --port $PORT"

    # Environment variables (set on Render dashboard)
    envVars:
      - key: FIREBASE_PROJECT_ID
        sync: false
      - key: FIREBASE_CLIENT_EMAIL
        sync: false
      - key: FIREBASE_PRIVATE_KEY
        sync: false
      - key: FIREBASE_DATABASE_URL
        sync: false
      - key: STRIPE_API_KEY
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false
      - key: HUGGINGFACE_API_TOKEN
        sync: false
      - key: GROQ_API_KEY
        sync: false
      - key: ALLOWED_ORIGINS
        sync: false

    # Health check path
    healthCheckPath: /health

    # Scaling
    scale:
      minInstances: 1
      maxInstances: 3

  # -----------------------
  # Worker Service
  # -----------------------
  - type: worker
    name: ai-intel-worker
    env: docker
    repo: https://github.com/Joeches/Website-Intelligence-Platform
    branch: main
    dockerfilePath: backend/Dockerfile
    plan: starter
    autoDeploy: true

    # Override CMD for worker
    startCommand: "python worker.py"

    # Environment variables (same as web)
    envVars:
      - key: FIREBASE_PROJECT_ID
        sync: false
      - key: FIREBASE_CLIENT_EMAIL
        sync: false
      - key: FIREBASE_PRIVATE_KEY
        sync: false
      - key: FIREBASE_DATABASE_URL
        sync: false
      - key: STRIPE_API_KEY
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false
      - key: HUGGINGFACE_API_TOKEN
        sync: false
      - key: GROQ_API_KEY
        sync: false
      - key: ALLOWED_ORIGINS
        sync: false
